<div class="tournament content__title">
  @if (this.tournament$ | async; as tournament) {
    <h3 class="tui-text_h3">
      {{ tournament.title | uppercase }}
    </h3>
    <p class="content__title_description">{{ tournament.description }}</p>
  } @else {
    <h3 class="tui-text_h3">
      <tui-loader [inheritColor]="true"></tui-loader>
    </h3>
  }
</div>

<div class="tournament content__body">
  <div class="one_col_container">
    @if (this.tournament$ | async; as tournament) {
      <div class="tournament content__body__title__flex">
        <app-body-title
          titleMany='matches'
        ></app-body-title>
        @if (tournament.id) {
          @if (teamsInTournament$ | async; as teams) {
            <app-create-button-show-dialog
              [item]="'Match'"
              [dialogId]="'addDialog'"
            ></app-create-button-show-dialog>
            <app-add-edit-match
              [action]="'add'"
              [dialogId]="'addDialog'"
              [tournamentId]="tournament.id"
              [teams$]="teamsInTournament$"
              (addEvent)="onMatchAdd($event)"
            ></app-add-edit-match>
          }
        } @else {
          <tui-loader></tui-loader>
        }
        <app-delete-button
          [item]="buttonTitle"
          [dialogId]="'deleteDialog'"
        ></app-delete-button>
        <app-delete-dialog
          [item]="buttonTitle"
          (delete)="onDelete()"
          [dialogId]="'deleteDialog'"
        ></app-delete-dialog>

      </div>
    } @else {
      <tui-loader [inheritColor]="true"></tui-loader>
    }
    <div class="tournament with__aside">
      <div class="one_col_container">
        @if (matchesWithFullData$ | async; as items) {
          <div class="filters flex__fullwidth_center">
            <form
              [formGroup]="formWeek"
            >
              <tui-input-number
                formControlName="matchWeekSearch"
                (tuiValueChanges)="onSearch()"
              >
                Search by WEEK
              </tui-input-number>
            </form>

            <app-form-search-text
              [data$]="matchesWithFullData$"
              [searchTitle]="'team'"
              [parameter]="'teams_data.team_a.title + teams_data.team_b.title'"
              [filter]="'includes'"
            ></app-form-search-text>

            <app-pagination-with-items-per-page
              [items$]="matchesWithFullData$"
            ></app-pagination-with-items-per-page>


          </div>
          <div class="list-of-items-with-data" style="padding: 20px">

            <app-list-of-matches
              [data$]="paginationService.paginatedItems$"
              [formatPath]='matchHref'
            >
            </app-list-of-matches>

          </div>
        } @else {
          <tui-loader [inheritColor]="true"></tui-loader>
        }
      </div>


      <aside>
        <h4 style="text-align: center">TEAMS</h4>
        @if (tournament$ | async; as tournament) {
          @if (teamsInTournament$ | async; as teams) {
            @for (team of teams; track team.id) {

              <tui-elastic-container>
                <div style="display: flex; justify-content: space-between; align-items: center">
                  <button
                    appearance="whiteblock"
                    size="xl"
                    tuiButton
                    type="button"
                    style="width: 80%"
                    (click)="navigateTo(teamItemHref(team))"
                  > {{ team.title }}
                  </button>
                  <app-delete-button-icon
                    [dialogId]="'removeDialog' + team.id"
                  ></app-delete-button-icon>
                  <app-remove-dialog
                    [item]="team.title | uppercase"
                    [dialogId]="'removeDialog' + team.id"
                    (delete)="onTeamRemoveFromTournament(team.id!, tournament.id!)"
                  ></app-remove-dialog>
                </div>
              </tui-elastic-container>

            }
          } @else {
            <tui-loader></tui-loader>
          }
          <app-create-button-show-dialog
            [item]="'Team'"
            [dialogId]="'addTeamToTournamentDialog' + tournament.id"
          ></app-create-button-show-dialog>
          <app-add-team-to-tournament
            [tournamentId]="tournament.id!"
            [sportId]="tournament.sport_id"
            [dialogId]="'addTeamToTournamentDialog' + tournament.id"
          ></app-add-team-to-tournament>
        }
      </aside>
    </div>

  </div>
</div>
