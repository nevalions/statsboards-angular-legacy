@if (match && match.match_id) {
  <form
    tuiTextfieldSize="m"
    [formGroup]="eventForm"
    [tuiTextfieldLabelOutside]="true"
    style="padding: 10px"
  >
    @if (events && events.length && eventForm && eventsArray && eventsArray.length) {
      <div class="event-table">
        <!--        @if (events && events.length) {-->
        <div formArrayName="events" class="event-table-body">
          <div
            *ngFor="let eventFormGroup of eventsArray.controls; let i = index"
            class="event-table-row"
            [formGroupName]="i"
          >
            <!--EVENT NUMBER-->
            <div class="event-num-qtr-row">
              <div class="event-table-cell">

                <label>Event Number</label>
                <tui-input-number
                  [tuiTextfieldCleaner]="true"
                  [min]="1"
                  [step]="1"
                  [formControl]="getFormControl(this.eventForm, i, 'eventNumber', this.arrayName)">
                </tui-input-number>

              </div>

              <!--EVENT QTR-->
              @if (getQtrFormControl(this.eventForm, this.arrayName, i); as control) {
                <div class="event-table-cell">
                  <label>Qtr</label>
                  <tui-input-number
                    [min]="1"
                    [max]="4"
                    [step]="1"
                    [tuiTextfieldCleaner]="true"
                    [formControl]="control">
                  </tui-input-number>
                </div>
              }
            </div>

            <!--BALL ON-->
            <div class="event-table-cell">
              <label>Ball On</label>
              <tui-input-number
                [tuiTextfieldSize]="'l'"
                [tuiTextfieldCleaner]="true"
                [min]="-50"
                [max]="50"
                [step]="1"
                [formControl]="getFormControl(this.eventForm, i, 'eventBallOn', this.arrayName)"
                (tuiValueChanges)="onBallOnChange($event, i)"
              >
              </tui-input-number>
            </div>


            <!--EVENT TEAM-->
            <div class="event-table-cell">
              @if (match && match.teams_data && match.teams_data.team_a && match.teams_data.team_b) {
                <label>Offence Team</label>
                <app-select-team-in-match
                  [placeholder]="'offence team'"
                  [teamsList]="[match.teams_data.team_a, match.teams_data.team_b]"
                  [control]="getFormControl(this.eventForm, i, 'eventTeam', this.arrayName)"
                  (teamSelected)="onTeamChange($event, i)"
                ></app-select-team-in-match>
              }
            </div>

            <!--EVENT QB-->
            <div class="event-table-cell">
              <ng-container *ngIf="getEventTeam(eventFormGroup, i, 'eventTeam') as selectedTeam">
                @if (getEventTeam(eventFormGroup, i, 'eventTeam'); as selectedTeam) {
                  <label>QB</label>
                  <app-search-player-in-match-autocomplete
                    [action]="'select'"
                    [placeholder]="'qb'"
                    [players]="getPlayersForSelectedTeam(selectedTeam)"
                    [control]="getFormControl(this.eventForm, i, 'eventQb', this.arrayName)">
                  </app-search-player-in-match-autocomplete>
                }
              </ng-container>
            </div>


            <!--EVENT DOWN-->
            <div class="event-table-cell">
              <div class="event-down-distance">
                <div class="event-down">
                  <label>Down</label>
                  <tui-input-number
                    [tuiTextfieldCleaner]="true"
                    [min]="1"
                    [max]="4"
                    [step]="1"
                    (tuiValueChanges)="onDownChange($event, i)"
                    [formControl]="getFormControl(this.eventForm, i, 'eventDown', this.arrayName)">
                  </tui-input-number>
                </div>
                <div class="event-distance">
                  <label>Distance</label>
                  <tui-input-number
                    [tuiTextfieldCleaner]="true"
                    [min]="1"
                    [max]="100"
                    [step]="1"
                    [formControl]="getFormControl(this.eventForm, i, 'eventDistance', this.arrayName)">
                  </tui-input-number>
                </div>
              </div>
            </div>

            <!--EVENT HASH-->
            <div class="event-hash-type">
              <div class="event-table-cell">
                <label>Hash</label>
                <app-select-enum
                  [control]="getFormControl(this.eventForm, i, 'eventHash', this.arrayName)"
                  [placeholder]="'hash'"
                  [enumObjects]="eventHashOptions"
                ></app-select-enum>
              </div>

              <!--EVENT PLAY TYPE-->
              <div class="event-table-cell">
                <label>Play Type</label>
                <app-select-enum
                  [control]="getFormControl(this.eventForm, i, 'eventPlayType', this.arrayName)"
                  [placeholder]="'play type'"
                  [enumObjects]="eventPlayTypeOptions"
                  (itemSelected)="onPlayTypeChange(this.eventsArray, $event, i)"
                ></app-select-enum>
              </div>
            </div>

            <!--EVENT PLAY RESULT-->
            <div class="event-table-cell">
              <label>Play Result</label>
              <app-select-enum
                [control]="getFormControl(this.eventForm, i, 'eventPlayResult', this.arrayName)"
                [placeholder]="'play result'"
                [enumObjects]="eventPlayResultOptions"
              ></app-select-enum>
            </div>

            <!--EVENT RUN PLAYER-->
            <div class="event-table-cell">
              @if (getEventTeam(eventFormGroup, i, 'eventTeam'); as selectedTeam) {
                @if (isPlayType(eventFormGroup, i, 'eventPlayType', IFootballPlayType.Run)) {
                  <label>Run Player</label>
                  <app-search-player-in-match-autocomplete
                    [action]="'select'"
                    [placeholder]="'run player'"
                    [players]="getPlayersForSelectedTeam(selectedTeam)"
                    [control]="getFormControl(this.eventForm, i, 'eventRunPlayer', this.arrayName)">
                  </app-search-player-in-match-autocomplete>
                }
              }
            </div>

            <!--EVENT PASS PLAYER-->
            <div class="event-table-cell">
              @if (getEventTeam(eventFormGroup, i, 'eventTeam'); as selectedTeam) {
                @if (isPlayType(eventFormGroup, i, 'eventPlayType', IFootballPlayType.Pass)) {
                  <label>Receiver Player</label>
                  <app-search-player-in-match-autocomplete
                    [action]="'select'"
                    [placeholder]="'receiver player'"
                    [players]="getPlayersForSelectedTeam(selectedTeam)"
                    [control]="getFormControl(this.eventForm, i, 'eventReceiverPlayer', this.arrayName)">
                  </app-search-player-in-match-autocomplete>
                }
              }
            </div>


            <!--ACTIONS-->
            @if (deleteOrUpdate == "delete") {
              @if (eventFormGroup.get("eventId" + i)!.value; as id) {
                <div class="table-cell">
                  <app-actions-buttons
                    [id]="id"
                    [index]="i"
                    [deleteOrUpdate]="'delete'"
                    [item]="getFormDataByIndexAndKey(eventFormGroup, i,'eventNumber')"
                    (onSubmit)="onSubmitNewEvent($event.action, $event.index, $event.id)"
                    [isEnabled]="isRowEnabled(i)"
                    [isDataChanged]="isDataChanged(i)"
                    (onEdit)="enableRowToEdit($event.index)"
                    (onCancel)="onCancelButtonClick()"
                    (onDelete)="onDeleteEvent($event.id!)"
                    (onDeleteDialog)="onDeleteButtonClick('deleteDialogPlayer' + $event.id!)"
                  ></app-actions-buttons>
                </div>
              } @else {
                <div class="table-cell actions">
                  <app-actions-buttons
                    [index]="i"
                    (onSubmit)="onSubmitNewEvent($event.action, $event.index, $event.id)"
                    (onCancel)="onCancelButtonClick()"
                  ></app-actions-buttons>
                </div>
              }
            }
          </div>
        </div>
        @if (events) {
          @if (!events.length || events[events.length - 1].id !== null) {
            <div class="table-row final">
              <app-add-button-on-final-tr
                [action]="'add event'"
                (onAdd)="addNewEvent()"
              ></app-add-button-on-final-tr>
            </div>
          }
        }

      </div>
    } @else {
      NO EVENTS
      <div class="table-row final">
        <app-add-button-on-final-tr
          (onAdd)="addNewEvent()"
        ></app-add-button-on-final-tr>
      </div>
    }
  </form>
} @else {
  NO MATCH ID
}
