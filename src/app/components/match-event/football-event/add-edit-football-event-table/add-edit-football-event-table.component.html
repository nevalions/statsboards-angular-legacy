@if (match && match.match_id) {
  <form
    tuiTextfieldSize="m"
    [formGroup]="eventForm"
    [tuiTextfieldLabelOutside]="true"
    style="padding: 10px"
  >
    @if (events && events.length && eventForm && eventsArray && eventsArray.length) {
      <div class="event-table">
        <div formArrayName="events" class="event-table-body">
          <div
            *ngFor="let eventFormGroup of eventsArray.controls; let i = index"
            class="event-table-row"
            [formGroupName]="i"
          >
            <!--EVENT NUMBER-->
            <div class="event-num-qtr-row">
              @if (getEventNumberFormControl(this.eventForm, this.arrayName, i); as control) {
                <div class="event-table-cell">
                  <label>Event Number</label>
                  <app-input-number-with-buttons
                    [control]="control"
                    [label]="'event number'"
                    [index]="i"
                    [key]="eventNumberKey"
                    (numberChanged)="handleFieldChange($event)"
                  ></app-input-number-with-buttons>
                </div>
              }

              <!--EVENT QTR-->
              @if (getQtrFormControl(this.eventForm, this.arrayName, i); as control) {
                <div class="event-table-cell">
                  <label>Qtr</label>
                  <app-input-number-with-buttons
                    [label]="'Qtr'"
                    [control]="control"
                    [index]="i"
                    [key]="eventQtrKey"
                    [min]="1"
                    [max]="4"
                    (numberChanged)="handleFieldChange($event)"
                  ></app-input-number-with-buttons>
                </div>
              }
            </div>

            <!--BALL ON-->
            @if (getBallOnFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                <label>Ball On</label>
                <app-input-number-with-buttons
                  [label]="'ball on'"
                  [control]="control"
                  [index]="i"
                  [key]="eventBallOnKey"
                  [min]="-50"
                  [max]="50"
                  [events]="events"
                  [eventsArray]="eventsArray"
                  (numberChanged)="handleFieldChange($event)"
                  [onBallOnChange]="onBallOnChange"
                ></app-input-number-with-buttons>
              </div>
            }

            <!--EVENT TEAM-->
            @if (getEventTeamFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                @if (match && match.teams_data && match.teams_data.team_a && match.teams_data.team_b) {
                  <label>Offence Team</label>
                  <app-select-team-in-match
                    [placeholder]="'offence team'"
                    [teamsList]="[match.teams_data.team_a, match.teams_data.team_b]"
                    [control]="control"
                    (teamSelected)="onTeamChange(eventsArray, $event, i)"
                  ></app-select-team-in-match>
                }
              </div>
            }

            <!--EVENT QB-->
            @if (getEventQbFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                @if (getEventTeam(eventsArray, i); as selectedTeam) {
                  <label>QB</label>
                  <app-search-player-in-match-autocomplete
                    [action]="'select'"
                    [placeholder]="'qb'"
                    [players]="getPlayersForSelectedTeam(selectedTeam)"
                    [control]="control">
                  </app-search-player-in-match-autocomplete>
                }
              </div>
            }

            <!--EVENT DOWN-->
            <div class="event-table-cell">
              <div class="event-down-distance">
                @if (getEventDownFormControl(this.eventForm, this.arrayName, i); as control) {
                  <div class="event-down">
                    <label>Down</label>
                    <app-input-number-with-buttons
                      [label]="'down'"
                      [control]="control"
                      [index]="i"
                      [key]="eventDownKey"
                      [min]="1"
                      [max]="4"
                      [eventsArray]="eventsArray"
                      (numberChanged)="handleFieldChange($event)"
                      [onDownChange]="onDownChange"
                    ></app-input-number-with-buttons>
                  </div>
                }
                @if (getEventDistanceFormControl(this.eventForm, this.arrayName, i); as control) {
                  <div class="event-distance">
                    <label>Distance</label>
                    <app-input-number-with-buttons
                      [label]="'Dist'"
                      [control]="control"
                      [index]="i"
                      [key]="eventDistanceKey"
                      [min]="1"
                      [max]="100"
                      (numberChanged)="handleFieldChange($event)"
                    ></app-input-number-with-buttons>
                  </div>
                }
              </div>
            </div>

            <!--EVENT HASH-->
            <div class="event-hash-type">
              @if (getEventHashFormControl(this.eventForm, this.arrayName, i); as control) {
                <div class="event-table-cell">
                  <label>Hash</label>
                  <app-select-enum
                    [control]="control"
                    [placeholder]="'hash'"
                    [enumObjects]="eventHashOptions"
                  ></app-select-enum>
                </div>
              }
              <!--EVENT PLAY TYPE-->
              @if (getEventPlayTypeFormControl(this.eventForm, this.arrayName, i); as control) {
                <div class="event-table-cell">
                  <label>Play Type</label>
                  <app-select-enum
                    [control]="control"
                    [placeholder]="'play type'"
                    [enumObjects]="eventPlayTypeOptions"
                    (itemSelected)="handlePlayTypeChange(eventsArray, $event, i)"
                  ></app-select-enum>
                </div>
              }
            </div>

            <!--EVENT PLAY RESULT-->
            @if (getEventPlayResultFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                <label>Play Result</label>
                <app-select-enum
                  [control]="control"
                  [placeholder]="'play result'"
                  [enumObjects]="eventFilteredPlayResultOptions"
                  (itemSelected)="handlePlayResultChange(eventsArray, $event, i)"
                ></app-select-enum>
              </div>
            }

            <!--EVENT RUN PLAYER-->
            @if (getEventRunPlayerFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                @if (getEventTeam(eventsArray, i); as selectedTeam) {
                  @if (isPlayType(eventFormGroup, i, eventPlayTypeKey, IFootballPlayType.Run) ||
                  getEventRunPlayer(eventsArray, i)) {
                    <label>Run Player</label>
                    <app-search-player-in-match-autocomplete
                      [action]="'select'"
                      [placeholder]="'run player'"
                      [players]="getPlayersForSelectedTeam(selectedTeam)"
                      [control]="control">
                    </app-search-player-in-match-autocomplete>
                  }
                }
              </div>
            }

            <!--EVENT RECEIVER PLAYER-->
            @if (getEventReceiverPlayerFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                @if (getEventTeam(eventsArray, i); as selectedTeam) {
                  @if (isPlayResult(eventFormGroup, i, eventPlayResultKey, IFootballPlayResult.PassCompleted) ||
                  getEventReceiverPlayer(eventsArray, i)) {
                    <label>Receiver Player</label>
                    <app-search-player-in-match-autocomplete
                      [action]="'select'"
                      [placeholder]="'receiver player'"
                      [players]="getPlayersForSelectedTeam(selectedTeam)"
                      [control]="control">
                    </app-search-player-in-match-autocomplete>
                  }
                }
              </div>
            }

            <!--EVENT DROPPED PLAYER-->
            @if (getEventDroppedPlayerFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                @if (getEventTeam(eventsArray, i); as selectedTeam) {
                  @if (isPlayResult(eventFormGroup, i, eventPlayResultKey, IFootballPlayResult.PassDropped) ||
                  getEventDroppedPlayer(eventsArray, i)) {
                    <label>Dropped Player</label>
                    <app-search-player-in-match-autocomplete
                      [action]="'select'"
                      [placeholder]="'dropped player'"
                      [players]="getPlayersForSelectedTeam(selectedTeam)"
                      [control]="control">
                    </app-search-player-in-match-autocomplete>
                  }
                }
              </div>
            }

            <!--EVENT KICK PLAYER-->
            @if (getEventKickPlayerFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                @if (getEventTeam(eventsArray, i); as selectedTeam) {
                  @if (isPlayType(eventFormGroup, i, eventPlayTypeKey, IFootballPlayType.Kick) ||
                  getEventKickPlayer(eventsArray, i)) {
                    <label>Kick Player</label>
                    <app-search-player-in-match-autocomplete
                      [action]="'select'"
                      [placeholder]="'kick player'"
                      [players]="getPlayersForSelectedTeam(selectedTeam)"
                      [control]="control">
                    </app-search-player-in-match-autocomplete>
                  }
                }
              </div>
            }

            <!--EVENT PUNT PLAYER-->
            @if (getEventPuntPlayerFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                @if (getEventTeam(eventsArray, i); as selectedTeam) {
                  @if (isPlayType(eventFormGroup, i, eventPlayTypeKey, IFootballPlayType.Punt) ||
                  getEventPuntPlayer(eventsArray, i)) {
                    <label>Punt Player</label>
                    <app-search-player-in-match-autocomplete
                      [action]="'select'"
                      [placeholder]="'punt player'"
                      [players]="getPlayersForSelectedTeam(selectedTeam)"
                      [control]="control">
                    </app-search-player-in-match-autocomplete>
                  }
                }
              </div>
            }

            <!--EVENT DEFLECTED PLAYER-->
            @if (getEventDeflectedPlayerFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                @if (getEventTeam(eventsArray, i); as selectedTeam) {
                  @if (isPlayResult(eventFormGroup, i, eventPlayResultKey, IFootballPlayResult.PassDeflected) ||
                  getEventDeflectedPlayer(eventsArray, i)) {
                    <label>Deflected Player</label>
                    <app-search-player-in-match-autocomplete
                      [action]="'select'"
                      [placeholder]="'deflected player'"
                      [players]="getDefencePlayersForTeam(selectedTeam)"
                      [control]="control">
                    </app-search-player-in-match-autocomplete>
                  }
                }
              </div>
            }

            <!--EVENT INTERCEPTED PLAYER-->
            @if (getEventInterceptedPlayerFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                @if (getEventTeam(eventsArray, i); as selectedTeam) {
                  @if (isPlayResult(eventFormGroup, i, eventPlayResultKey, IFootballPlayResult.PassIntercepted) ||
                  getEventInterceptedPlayer(eventsArray, i)) {
                    <label>Intercepted Player</label>
                    <app-search-player-in-match-autocomplete
                      [action]="'select'"
                      [placeholder]="'intercepted player'"
                      [players]="getDefencePlayersForTeam(selectedTeam)"
                      [control]="control">
                    </app-search-player-in-match-autocomplete>
                  }
                }
              </div>
            }

            <!--EVENT SACK PLAYER-->
            @if (getEventSackPlayerFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                @if (getEventTeam(eventsArray, i); as selectedTeam) {
                  @if (isPlayResult(eventFormGroup, i, eventPlayResultKey, IFootballPlayResult.Sack) ||
                  getEventSackPlayer(eventsArray, i)) {
                    <label>Sack Player</label>
                    <app-search-player-in-match-autocomplete
                      [action]="'select'"
                      [placeholder]="'sack player'"
                      [players]="getDefencePlayersForTeam(selectedTeam)"
                      [control]="control">
                    </app-search-player-in-match-autocomplete>
                  }
                }
              </div>
            }

            <!--EVENT TACKLE PLAYER-->
            @if (getEventTacklePlayerFormControl(this.eventForm, this.arrayName, i); as control) {
              <div class="event-table-cell">
                @if (getEventTeam(eventsArray, i); as selectedTeam) {
                  @if (!isPlayResult(eventFormGroup, i, eventPlayResultKey, IFootballPlayResult.Flag) ||
                  getEventTacklePlayer(eventsArray, i)) {
                    <label>Tackle Player</label>
                    <app-search-player-in-match-autocomplete
                      [action]="'select'"
                      [placeholder]="'tackle player'"
                      [players]="getDefencePlayersForTeam(selectedTeam)"
                      [control]="control"
                      (reset)="control.setValue(null)"
                    >
                    </app-search-player-in-match-autocomplete>
                  }
                }
              </div>
            }


            <!--ACTIONS-->
            @if (deleteOrUpdate == "delete") {
              @if (eventFormGroup.get("eventId" + i)!.value; as id) {
                @if (getEventNumber(this.eventsArray, i); as eventNumber) {
                  <div class="table-cell">
                    <app-actions-buttons
                      [id]="id"
                      [index]="i"
                      [deleteOrUpdate]="'delete'"
                      [item]="eventNumber.toString()"
                      (onSubmit)="onSubmitEvent($event.action, $event.index, $event.id)"
                      [isEnabled]="isFullRowEnabled(eventsArray, i)"
                      [isDataChanged]="isDataChanged(eventsArray, i)"
                      (onEdit)="enableFullRowToEdit(eventsArray, $event.index)"
                      (onCancel)="onCancelButtonClick()"
                      (onDelete)="onDeleteEvent($event.id!)"
                      (onDeleteDialog)="onDeleteButtonClick('deleteDialogPlayer' + $event.id!)"
                    ></app-actions-buttons>
                  </div>
                }
              } @else {
                <div class="table-cell actions">
                  <app-actions-buttons
                    [index]="i"
                    (onSubmit)="onSubmitEvent($event.action, $event.index, $event.id)"
                    (onCancel)="onCancelButtonClick()"
                  ></app-actions-buttons>
                </div>
              }
            }
          </div>
        </div>
        @if (events) {
          @if (!events.length || events[events.length - 1].id !== null) {
            <div class="table-row final">
              <app-add-button-on-final-tr
                [action]="'add event'"
                (onAdd)="addNewEvent()"
              ></app-add-button-on-final-tr>
            </div>
          }
        }

      </div>
    } @else {
      NO EVENTS
      <div class="table-row final">
        <app-add-button-on-final-tr
          (onAdd)="addNewEvent()"
        ></app-add-button-on-final-tr>
      </div>
    }
  </form>
} @else {
  NO MATCH ID
}
