<form
  tuiTextfieldSize="m"
  [formGroup]="playerForm"
  [tuiTextfieldLabelOutside]="true"
>
  <table
    tuiTable
    [size]="'l'"
    class="table-players"
    style="width: 100%;padding: 20px;"
  >
    <thead>
    <tr>
      <th tuiTh>Full Name</th>
      @if (teamId) {
        <th tuiTh>Number</th>
      } @else {
        <th tuiTh>Team</th>
      }
      <th tuiTh>Position</th>
      <th tuiTh>Actions</th>
    </tr>
    </thead>

    <tbody formArrayName="players">
      @if (players) {
        @for (playerFormGroup of playersArray.controls; let i = $index; track i) {
          <tr [formGroupName]="i">
            <td tuiTd>
              @if (getFormDataByIndexAndKey(playerFormGroup, i, 'playerId')) {
                @if (getFormDataByIndexAndKey(playerFormGroup, i, 'fullName'); as name) {
                  {{ name | uppercase }}
                }
              } @else {

                <app-select-player-to-team-tournament
                  [playerList]="availablePlayersInSport"
                  [tournamentId]="tournamentId"
                  [control]="getFormControl(this.playerForm, i, 'playerInSport', 'players')"
                ></app-select-player-to-team-tournament>

              }
            </td>

            <td tuiTd>
              @if (teamId) {
                <app-select-player-number
                  [control]="getFormControl(this.playerForm, i, 'number', 'players')"
                ></app-select-player-number>
              } @else {
                @if (getFormDataByIndexAndKey(playerFormGroup, i, 'team'); as team) {
                  {{ team | uppercase }}
                }
              }
            </td>
            <td tuiTd>
              @if (sportId) {
                @if (positions) {
                  <app-select-player-position
                    [positionList]="positions"
                    [index]="i"
                    [sportId]="sportId"
                    [control]="getFormControl(this.playerForm, i, 'position', 'players')"
                  ></app-select-player-position>
                }
              }
            </td>
            <td tuiTd>
              @if (playerFormGroup.get('playerInTeamId' + i)!.value; as id) {
                <app-actions-buttons
                  [id]="id"
                  [index]="i"
                  (onSubmit)="onSubmit($event.action, $event.index, $event.id)"
                  (onCancel)="onCancelButtonClick()"
                  (onDelete)="onDeleteButtonClick('deleteDialogPlayer'+$event.id)"
                ></app-actions-buttons>
                <!--                {{ id }}-->
                @if (players) {
                  <app-delete-dialog
                    [item]="playerFormGroup.get('fullName' + i)!.value"
                    (delete)="onDelete(id)"
                    [dialogId]="'deleteDialogPlayer'+id"
                  ></app-delete-dialog>
                }
              } @else {
                <app-actions-buttons
                  [index]="i"
                  (onSubmit)="onSubmit($event.action, $event.index, $event.id)"
                  (onCancel)="onCancelButtonClick()"
                ></app-actions-buttons>
              }
            </td>
          </tr>
        }
        @if (!players.length || players[players.length - 1].playerInTeamTournament.id !== null) {
          <tr>
            <td class="table-cell" tuiTd [attr.colspan]="4">
              <app-add-button-on-final-tr
                [span]="4"
                (onAdd)="addNewPlayer()"
              ></app-add-button-on-final-tr>
            </td>
          </tr>
        }
      } @else {
        <tr>
          <td class="table-cell" tuiTd [attr.colspan]="4">
            <app-add-button-on-final-tr
              [span]="4"
              (onAdd)="addNewPlayer()"
            ></app-add-button-on-final-tr>
          </td>
        </tr>
      }
    </tbody>
  </table>
</form>

