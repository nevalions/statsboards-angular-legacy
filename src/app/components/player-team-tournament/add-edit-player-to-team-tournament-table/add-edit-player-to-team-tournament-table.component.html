<form
  tuiTextfieldSize="m"
  [formGroup]="playerForm"
  [tuiTextfieldLabelOutside]="true"
>
  <table
    tuiTable
    [size]="'s'"
    class="table-players"
    style="width: 100%;padding: 20px;"
  >
    <thead>
    <tr>
      <th tuiTh>Full Name</th>
      @if (teamId) {
        <th tuiTh>Number</th>
      } @else {
        <th tuiTh>Team</th>
      }
      <th tuiTh>Position</th>
      <th tuiTh>Actions</th>
    </tr>
    </thead>

    <tbody formArrayName="players">
      @if (players) {
        @for (playerFormGroup of playersArray.controls; let i = $index; track i) {
          <tr [formGroupName]="i">
            <td tuiTd>
              @if (getFormDataByIndexAndKey(playerFormGroup, i, 'playerId')) {
                @if (getFormDataByIndexAndKey(playerFormGroup, i, 'fullName'); as name) {
                  {{ name | uppercase }}
                }
              } @else {
                @if (availablePlayersInSport.length > 0) {
                  <app-select-player-to-team-tournament
                    [playerList]="availablePlayersInSport"
                    [tournamentId]="tournamentId"
                    [control]="getFormControl(this.playerForm, i, 'playerInSport', 'players')"
                  ></app-select-player-to-team-tournament>
                } @else {
                  <app-select-player-to-team-tournament
                    [playerListFromTournament]="availablePlayersInTournament"
                    [tournamentId]="tournamentId"
                    [control]="getFormControl(this.playerForm, i, 'playerInSport', 'players')"
                    (playerSelect)="onPlayerSelect($event, i)"
                  ></app-select-player-to-team-tournament>
                }

              }
            </td>

            <td tuiTd>
              @if (teamId) {
                @if (isRowEnabled(i)) {
                  <app-select-player-number
                    [control]="getFormControl(this.playerForm, i, 'number', 'players')"
                  ></app-select-player-number>
                } @else {
                  {{ getFormDataByIndexAndKey(playerFormGroup, i, 'number') }}
                }

              } @else {
                @if (isRowEnabled(i)) {
                  <app-select-team
                    [control]="getFormControl(this.playerForm, i, 'team', 'players')"
                    [teamsList]="teamsInTournament"
                  ></app-select-team>
                } @else {
                  {{ getFormDataByIndexAndKey(playerFormGroup, i, 'team')?.title | uppercase }}
                }

              }
            </td>
            <td tuiTd>
              @if (sportId) {
                @if (positions) {
                  @if (isRowEnabled(i)) {
                    <app-select-player-position
                      [positionList]="positions"
                      [index]="i"
                      [sportId]="sportId"
                      [control]="getFormControl(this.playerForm, i, 'position', 'players')"
                    ></app-select-player-position>
                  } @else {
                    {{ getFormDataByIndexAndKey(playerFormGroup, i, 'position')?.title | uppercase }}
                  }
                }
              }
            </td>
            <td tuiTd>
              @if (playerFormGroup.get('playerInTeamId' + i)!.value; as id) {

                @if (deleteOrUpdate == 'deleteFromTeam') {
                  <app-actions-buttons
                    [id]="id"
                    [index]="i"
                    [deleteOrUpdate]="'deleteFromTeam'"
                    [item]="getFormDataByIndexAndKey(playerFormGroup, i, 'fullName') | uppercase"
                    [isEnabled]="isRowEnabled(i)"
                    [isDataChanged]="isDataChanged(i)"
                    (onEdit)="enableRowToEdit($event.index)"
                    (onSubmit)="onSubmit($event.action, $event.index, $event.id)"
                    (onCancel)="onCancelButtonClick()"
                    (onDeleteUpdate)="onSubmit($event.action, $event.index, $event.id)"
                    (onDeleteDialog)="onDeleteButtonClick('deleteDialogPlayer'+$event.id!)"
                  ></app-actions-buttons>
                } @else {

                  <app-actions-buttons
                    [id]="id"
                    [index]="i"
                    [deleteOrUpdate]="'delete'"
                    [item]="getFormDataByIndexAndKey(playerFormGroup, i, 'fullName') | uppercase"
                    [isEnabled]="isRowEnabled(i)"
                    [isDataChanged]="isDataChanged(i)"
                    (onEdit)="enableRowToEdit($event.index)"
                    (onDelete)="onDelete($event.id!)"
                    (onSubmit)="onSubmit($event.action, $event.index, $event.id)"
                    (onCancel)="onCancelButtonClick()"
                    (onDeleteDialog)="onDeleteButtonClick('deleteDialogPlayer'+$event.id!)"
                  ></app-actions-buttons>

                }
              } @else {
                <app-actions-buttons
                  [index]="i"
                  (onSubmit)="onSubmit($event.action, $event.index, $event.id)"
                  (onCancel)="onCancelButtonClick()"
                ></app-actions-buttons>
              }
            </td>
          </tr>
        }
        @if (!players.length || players[players.length - 1].playerInTeamTournament.id !== null) {
          <tr>
            <td class="table-cell" tuiTd [attr.colspan]="4">
              <app-add-button-on-final-tr
                [span]="4"
                (onAdd)="addNewPlayer()"
              ></app-add-button-on-final-tr>
            </td>
          </tr>
        }
      } @else {
        <tr>
          <td class="table-cell" tuiTd [attr.colspan]="4">
            <app-add-button-on-final-tr
              [span]="4"
              (onAdd)="addNewPlayer()"
            ></app-add-button-on-final-tr>
          </td>
        </tr>
      }
    </tbody>
  </table>
</form>

